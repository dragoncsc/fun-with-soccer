import numpy as np
import plotly as py
import plotly.graph_objs as go

xG_raw = """2  :  2.27605588156
4  :  3.56236134982
0  :  0.877724243762
2  :  3.14365343804
3  :  1.43991903019
0  :  1.39960216783
3  :  2.62617404062
1  :  0.72701852365
4  :  1.79225858445
1  :  2.14874460179
2  :  2.84657387639
4  :  5.12634933372
2  :  1.07907618606
3  :  3.30825650708
3  :  0.715556603916
3  :  3.45087689378
5  :  2.11029746829
5  :  1.71798432587
6  :  2.67986303531
0  :  1.19747297558
4  :  3.45825594985
2  :  3.98593826082
5  :  3.93664429172
4  :  3.00330899095
1  :  0.730039734082
1  :  0.991161739086
1  :  2.39443136875
5  :  2.94326817003
3  :  2.09536206654
2  :  1.66394589203
1  :  1.92258818805
3  :  3.76668920496
4  :  2.04821971248
5  :  2.07681667395
5  :  2.09704113923
2  :  1.70459570569
2  :  3.60580892013
5  :  3.26854290622
8  :  3.5136927681
8  :  4.14115683142
4  :  1.70591770645
4  :  1.92710056529
3  :  3.02687889569
4  :  1.63347179528
6  :  3.56879085004
4  :  5.78942308501
4  :  6.62578902305
2  :  3.51070673663
1  :  0.3125736659
2  :  3.45487899468
2  :  1.88495417311
2  :  2.62660885012
3  :  1.19657446649
3  :  2.72997008949
1  :  1.20607091912
6  :  4.08763752673
5  :  4.08800214371
2  :  1.62031267585
5  :  2.44349911482
3  :  1.94493384779
3  :  2.46115878127
3  :  2.90760876407
2  :  1.57263469694
2  :  4.06327747112
1  :  2.08845759119
5  :  3.64811272182
1  :  1.31007953529
4  :  6.27195250266
2  :  3.7081707238
3  :  2.17461952597
1  :  2.23798027845
4  :  3.26429726097
5  :  1.64477906994
4  :  2.54800543664
1  :  0.958946676085
2  :  2.91105558467
3  :  2.23956672437
3  :  2.97393436229
2  :  1.21452139529
5  :  2.89475597145
2  :  2.29180178541
3  :  2.95205692094
1  :  1.95167357647
3  :  3.685440704
1  :  1.70076331519"""



xG_raw = """3  :  2.13631613664
1  :  2.17991863016
3  :  2.43618832693
3  :  3.0214419126
4  :  4.30995566782
3  :  2.44827823455
1  :  1.37222445886
0  :  2.40191659842
2  :  3.44527770306
1  :  0.787117961032
2  :  2.39459021646
3  :  1.50453543836
5  :  2.84035220815
0  :  0.229229124944
2  :  1.67498928737
2  :  0.881073439699
4  :  2.4240449994
1  :  2.15457615233
0  :  0.896505571054
1  :  0.729578562645
1  :  1.30690973268
0  :  1.70615580543
2  :  1.01096641694
0  :  2.05802501579
1  :  0.919390333185
3  :  2.58635457056
1  :  0.394213962003
0  :  1.93398277137
3  :  0.423383247056
3  :  2.75860557476
0  :  1.31654783763
0  :  1.66506189341
3  :  2.54866161744
0  :  1.12792977349
1  :  0.944924020033
1  :  0.822324181471
1  :  1.35262786392
1  :  1.63791017672
4  :  3.83654690513
2  :  0.483439340089
3  :  1.3172457203
0  :  0.985792590624
4  :  3.11863992607
1  :  1.16929143756
1  :  1.71229852558
3  :  1.68421552922
3  :  2.46936611879
1  :  0.90993581397
2  :  1.77407123025
1  :  0.94408148513
1  :  1.45748276824
1  :  0.680846901203
2  :  3.97617408162
2  :  3.41517738804
2  :  2.80978948321
2  :  1.04377163836
2  :  0.674342998377
1  :  1.95096093664
2  :  1.58268972369
1  :  1.40374624766
4  :  2.14941948933
1  :  1.6126141698
0  :  1.02029176963
4  :  1.55742395788
4  :  1.32219594724
4  :  2.75043328102
1  :  1.90227668417
0  :  0.466803601396
1  :  1.47839636497
2  :  2.05114224041
2  :  1.70574706667
2  :  1.76321362694
1  :  2.50881144103
4  :  2.66209804205
3  :  1.82983062984
3  :  2.61628094984
3  :  1.91275312448
1  :  1.29062280315
3  :  2.32737243994
0  :  0.989381482763
4  :  2.85600602295
0  :  1.01803016216
1  :  1.3422697728
1  :  0.797286557652
3  :  2.06437525518
3  :  1.21036930389
4  :  2.59087530918
2  :  1.96854470667
1  :  1.48287604371
2  :  1.87983986572
4  :  1.62379231716
1  :  1.53063645085
0  :  3.09061561968
2  :  2.6134976256
2  :  3.32896685307
4  :  2.95140053898
0  :  1.43793613433
3  :  1.48039614034
3  :  1.62271744858
4  :  1.20493592353
1  :  2.049185794
2  :  1.75072520621
4  :  1.9955103658
0  :  1.34313048021
3  :  0.924408696747
2  :  1.50345618705
4  :  2.71112507817
1  :  2.50481592754
3  :  2.15576322279
2  :  2.23453658689
2  :  2.04781437486
1  :  4.91773041792"""















xG_raw = """3  :  2.13631613664  :  2015-02-11 00:00:00
1  :  2.17991863016  :  2017-04-30 00:00:00
3  :  2.43618832693  :  2014-11-29 00:00:00
3  :  3.0214419126  :  2017-09-12 00:00:00
4  :  4.30995566782  :  2017-01-07 00:00:00
3  :  2.44827823455  :  2014-05-06 00:00:00
1  :  1.37222445886  :  2014-08-16 00:00:00
0  :  2.40191659842  :  2015-12-05 00:00:00
2  :  3.44527770306  :  2015-02-28 00:00:00
1  :  0.787117961032  :  2016-09-10 00:00:00
2  :  2.39459021646  :  2015-09-30 00:00:00
3  :  1.50453543836  :  2015-09-12 00:00:00
5  :  2.84035220815  :  2011-12-26 00:00:00
0  :  0.229229124944  :  2016-01-23 00:00:00
2  :  1.67498928737  :  2016-01-02 00:00:00
2  :  0.881073439699  :  2017-05-21 00:00:00
4  :  2.4240449994  :  2014-03-29 00:00:00
1  :  2.15457615233  :  2017-04-04 00:00:00
0  :  0.896505571054  :  2014-03-25 00:00:00
1  :  0.729578562645  :  2016-04-03 00:00:00
1  :  1.30690973268  :  2017-01-15 00:00:00
0  :  1.70615580543  :  2017-02-01 00:00:00
2  :  1.01096641694  :  2012-09-29 00:00:00
0  :  2.05802501579  :  2012-12-05 00:00:00
1  :  0.919390333185  :  2013-09-28 00:00:00
3  :  2.58635457056  :  2012-12-15 00:00:00
1  :  0.394213962003  :  2013-11-10 00:00:00
0  :  1.93398277137  :  2014-05-03 00:00:00
3  :  0.423383247056  :  2016-02-28 00:00:00
3  :  2.75860557476  :  2013-12-21 00:00:00
0  :  1.31654783763  :  2015-11-25 00:00:00
0  :  1.66506189341  :  2013-12-04 00:00:00
3  :  2.54866161744  :  2012-11-24 00:00:00
0  :  1.12792977349  :  2015-08-22 00:00:00
1  :  0.944924020033  :  2015-12-19 00:00:00
1  :  0.822324181471  :  2015-08-08 00:00:00
1  :  1.35262786392  :  2013-10-23 00:00:00
1  :  1.63791017672  :  2016-01-09 00:00:00
4  :  3.83654690513  :  2014-04-26 00:00:00
2  :  0.483439340089  :  2017-04-16 00:00:00
3  :  1.3172457203  :  2013-10-26 00:00:00
0  :  0.985792590624  :  2015-01-11 00:00:00
4  :  3.11863992607  :  2017-09-17 00:00:00
1  :  1.16929143756  :  2015-05-17 00:00:00
1  :  1.71229852558  :  2014-01-01 00:00:00
3  :  1.68421552922  :  2014-12-26 00:00:00
3  :  2.46936611879  :  2016-12-26 00:00:00
1  :  0.90993581397  :  2016-05-01 00:00:00
2  :  1.77407123025  :  2015-11-07 00:00:00
1  :  0.94408148513  :  2014-11-08 00:00:00
1  :  1.45748276824  :  2013-12-10 00:00:00
1  :  0.680846901203  :  2016-11-19 00:00:00
2  :  3.97617408162  :  2014-02-09 00:00:00
2  :  3.41517738804  :  2016-12-31 00:00:00
2  :  2.80978948321  :  2013-09-14 00:00:00
2  :  1.04377163836  :  2016-04-20 00:00:00
2  :  0.674342998377  :  2014-09-27 00:00:00
1  :  1.95096093664  :  2016-11-27 00:00:00
2  :  1.58268972369  :  2014-01-28 00:00:00
1  :  1.40374624766  :  2012-11-28 00:00:00
4  :  2.14941948933  :  2017-09-30 00:00:00
1  :  1.6126141698  :  2015-11-03 00:00:00
0  :  1.02029176963  :  2013-08-26 00:00:00
4  :  1.55742395788  :  2013-03-02 00:00:00
4  :  1.32219594724  :  2011-12-10 00:00:00
4  :  2.75043328102  :  2014-09-14 00:00:00
1  :  1.90227668417  :  2014-10-26 00:00:00
0  :  0.466803601396  :  2015-10-25 00:00:00
1  :  1.47839636497  :  2016-04-16 00:00:00
2  :  2.05114224041  :  2017-08-26 00:00:00
2  :  1.70574706667  :  2013-01-30 00:00:00
2  :  1.76321362694  :  2012-12-29 00:00:00
1  :  2.50881144103  :  2016-10-02 00:00:00
4  :  2.66209804205  :  2017-01-29 00:00:00
3  :  1.82983062984  :  2015-09-26 00:00:00
3  :  2.61628094984  :  2012-08-25 00:00:00
3  :  1.91275312448  :  2015-01-31 00:00:00
1  :  1.29062280315  :  2013-10-19 00:00:00
3  :  2.32737243994  :  2012-01-14 00:00:00
0  :  0.989381482763  :  2013-12-07 00:00:00
4  :  2.85600602295  :  2012-10-20 00:00:00
0  :  1.01803016216  :  2015-12-28 00:00:00
1  :  1.3422697728  :  2017-03-04 00:00:00
1  :  0.797286557652  :  2016-03-02 00:00:00
3  :  2.06437525518  :  2015-04-04 00:00:00
3  :  1.21036930389  :  2014-12-14 00:00:00
4  :  2.59087530918  :  2012-12-26 00:00:00
2  :  1.96854470667  :  2014-10-05 00:00:00
1  :  1.48287604371  :  2016-12-11 00:00:00
2  :  1.87983986572  :  2017-02-11 00:00:00
4  :  1.62379231716  :  2013-09-17 00:00:00
1  :  1.53063645085  :  2011-11-05 00:00:00
0  :  3.09061561968  :  2016-10-29 00:00:00
2  :  2.6134976256  :  2012-01-31 00:00:00
2  :  3.32896685307  :  2012-03-11 00:00:00
4  :  2.95140053898  :  2012-09-15 00:00:00
0  :  1.43793613433  :  2017-04-01 00:00:00
3  :  1.48039614034  :  2016-05-17 00:00:00
3  :  1.62271744858  :  2013-04-22 00:00:00
4  :  1.20493592353  :  2015-04-12 00:00:00
1  :  2.049185794  :  2016-03-13 00:00:00
2  :  1.75072520621  :  2016-08-19 00:00:00
4  :  1.9955103658  :  2017-08-13 00:00:00
0  :  1.34313048021  :  2014-03-16 00:00:00
3  :  0.924408696747  :  2015-03-15 00:00:00
2  :  1.50345618705  :  2014-12-02 00:00:00
4  :  2.71112507817  :  2016-09-24 00:00:00
1  :  2.50481592754  :  2012-09-19 00:00:00
3  :  2.15576322279  :  2016-02-02 00:00:00
2  :  2.23453658689  :  2011-11-22 00:00:00
2  :  2.04781437486  :  2014-01-11 00:00:00
1  :  4.91773041792  :  2011-11-26 00:00:00"""


raw = xG_raw.split('\n')
goals = np.array([float(line.split(":")[0].strip()) for line in raw])
xG = np.array([float(line.split(":")[1].strip()) for line in raw])
x_axis = [date.split(":")[2] for date in raw]
cntr = []

indexes = sorted(range(len(x_axis)), key=lambda k: x_axis[k])


print (goals-xG).sum()/float(xG.size)

window_width = len(goals)
#cumsum_vec = np.cumsum(np.insert(goals - xG, 0, 0))
#print cumsum_vec
#ma_vec = (cumsum_vec[window_width:] - cumsum_vec[:-window_width]) / window_width


np.convolve(goals - xG, np.ones((1,))/1, mode='valid')
xG = np.array([xG[i] for i in indexes])
goals = np.array([goals[i] for i in indexes])
averages = [np.mean(goals[:i]-xG[:i]) for i in range(1,len(xG)+1)]
print averages
print xG


trace1 = go.Bar(
    x=[x_axis[i] for i in indexes],
    y=xG,
    name='Expected Goals'
)
trace2 = go.Bar(
    x=[x_axis[i] for i in indexes],
    y=goals,
    name='Actual Goals'
)
trace3 = go.Scatter(
    x = [x_axis[i] for i in indexes],
    y = [averages[i] for i in indexes],
    mode = 'lines+markers',
    name = 'Running average of error (actual goals-expected goals)'
)

data = [trace1, trace2, trace3]
layout = go.Layout(
    barmode='group',
    bargap=0.15,
    bargroupgap=0.1,
    title="Expected Goals vs. Actual Goals Bayern Mnchen Past 85 Games",
    xaxis={"title":"Past Game (Unfortunately arbitrarily ordered)"},
    yaxis={"title":"Goals scored"}
)
fig = go.Figure(data=data, layout=layout)
py.offline.plot(fig, filename='stacked-bar')







